# Codebase Structure

**Analysis Date:** 2026-02-18

## Directory Layout

```
[project-root]/
├── node_modules/               # Installed dependencies for workspace scripts + packages
├── package.json                # Orchestrates relay/sdk/wallet dev commands (`scripts.dev:*`)
├── scripts/                    # Workspace automation (currently empty placeholder)
├── zero-auth-relay/            # Express relay service with Redis-backed session flow
│   ├── circuits/               # Verification keys (`student_check_vKey.json`, etc.) used by `src/lib/verifier.ts`
│   ├── dist/                   # Compiled JS output from `tsc`
│   └── src/                    # Config, HTTP entry (`index.ts`), services, and libs (network/redis/verifier)
├── zero-auth-sdk/              # Publishable SDK that wraps relay handshake logic
│   ├── src/                    # `ZeroAuth` class + type defs (`index.ts`, `types.ts`)
│   └── examples/               # Demo app illustrating SDK usage (`examples/basic/src`)
└── zero-auth-wallet/           # Expo-based mobile wallet
    ├── app/                    # Screens for onboarding, tabs (dashboard/history/scan/credentials/settings), and credential flows
    ├── components/             # Shared UI widgets + `ZKEngine` WebView bridge
    ├── hooks/                  # React hooks (e.g., theming) consumed by screens
    ├── lib/                    # Wallet helpers (proof generation, QR parsing, wallet key management, storage adapters)
    ├── store/                  # Zustand stores (`auth-store.ts`, `wallet-store.ts`)
    ├── assets/                 # Static bundles/images plus bundled circuits used by the WebView bridge
    ├── circuits/               # Compiled `.wasm/.zkey` files and Circom sources used by `lib/proof.ts`
    ├── scripts/                # Helpers like `bundle-zk.js` that generate bundled assets
    ├── android/                # Native Gradle config generated by Expo
    ├── .expo/                  # Expo cache + metadata (generated by CLI)
    ├── app.json                # Expo configuration
    ├── tsconfig.json           # TypeScript settings for the app
    ├── tailwind.config.js      # Tailwind design tokens consumed by `nativewind`
    └── package.json            # Expo app dependencies and scripts (`bundle:zk`, `start`, etc.)
```

## Directory Purposes

**`zero-auth-relay/`:**
- Purpose: Relay API responsible for mediating QR session creation, proof acceptance, and session state.
- Contains: `src/index.ts` (Express + middleware), `src/services/session.service.ts`, `src/lib/{network,redis,verifier}.ts`, `circuits/` with verification keys.
- Key files: `zero-auth-relay/src/index.ts`, `zero-auth-relay/src/services/session.service.ts`.

**`zero-auth-sdk/`:**
- Purpose: Minimal SDK for other frontends to interact with the relay without duplicating polling logic.
- Contains: `ZeroAuth` class, `types.ts`, and a basic example under `examples/basic/src` that demos `ZeroAuth.verify()`.
- Key files: `zero-auth-sdk/src/index.ts`, `zero-auth-sdk/src/types.ts`.

**`zero-auth-wallet/app/`:**
- Purpose: Expo-router screens for onboarding, dashboard, scanning, approval, credential management, and settings.
- Contains: `app/_layout.tsx` (router root), `(tabs)` group (`index.tsx`, `history.tsx`, `scanner.tsx`, `credentials.tsx`, `settings.tsx`), and specialized flows such as `approve-request.tsx`, `add-credential/*`, `my-qr.tsx`, `onboarding.tsx`.
- Key files: `zero-auth-wallet/app/_layout.tsx`, `zero-auth-wallet/app/(tabs)/index.tsx`, `zero-auth-wallet/app/approve-request.tsx`.

**`zero-auth-wallet/components/`:**
- Purpose: Reusable UI (e.g., `SessionCard.tsx`, `NotificationModal.tsx`, `CustomAlert.tsx`) plus the ZK WebView bridge (`ZKEngine.tsx`).
- Contains: visual primitives and the provider that injects bundled SnarkJS/Poseidon code.
- Key files: `zero-auth-wallet/components/ZKEngine.tsx`, `zero-auth-wallet/components/SessionCard.tsx`.

**`zero-auth-wallet/store/`:**
- Purpose: Client-side state management with `zustand` stores for sessions/credentials (`auth-store.ts`) and wallet identity (`wallet-store.ts`).
- Contains: actions like `addSession`, `terminateSession`, `seedDemoData`, and `initializeWallet` tied to native storage.
- Key files: `zero-auth-wallet/store/auth-store.ts`, `zero-auth-wallet/store/wallet-store.ts`.

**`zero-auth-wallet/lib/`:**
- Purpose: Platform-specific helpers—hashing (`hashing.ts`), proof generation (`proof.ts`), wallet key CRUD (`wallet.ts`), QR parsing (`qr-protocol.ts`), bridge types (`zk-bridge-types.ts`), storage adapter (`storage.ts`).
- Key files: `zero-auth-wallet/lib/proof.ts`, `zero-auth-wallet/lib/wallet.ts`, `zero-auth-wallet/lib/qr-protocol.ts`.

**`zero-auth-wallet/circuits/` and `assets/circuits/`:**
- Purpose: `circuits/` holds compiled Circom sources (`*.wasm`, `*.zkey`, `*.r1cs`); `assets/circuits/` stores runtime copies of verification keys used by the wallet and relay.
- Generated by: `zero-auth-wallet/scripts/compile-circuit.sh` or `bundle-zk.js` and committed for reproducible ZK jobs.
- Key files: `zero-auth-wallet/circuits/age_check_final.zkey`, `zero-auth-wallet/assets/circuits/verification_key.json`.

## Key File Locations

**Entry Points:**
- `zero-auth-relay/src/index.ts`: Starts Express, wires routes and middleware, logs via `pino`, and listens on `env.PORT`.
- `zero-auth-sdk/src/index.ts`: Exported `ZeroAuth` entry that handles session creation/polling/cancel semantics.
- `zero-auth-wallet/app/_layout.tsx`: Router root that polyfills browser APIs, locks splash screen, injects `ZKProvider`, and routes to onboarding or `(tabs)`.
- `zero-auth-wallet/app/(tabs)/_layout.tsx`: Tab navigator definition (Dashboard, History, Scan, Credentials, Settings) that organizes `app/(tabs)` screens.

**Configuration:**
- `zero-auth-relay/tsconfig.json` and `package.json`: Build config for the relay TypeScript service.
- `zero-auth-wallet/tsconfig.json`, `tailwind.config.js`, `app.json`: Define Expo/tooling settings for the wallet app.

**Core Logic:**
- `zero-auth-relay/src/services/session.service.ts`: Session lifecycle, QR payload construction, Redis storage, proof verification.
- `zero-auth-wallet/lib/proof.ts`: Circuit input preparation and proof generation via `ZKEngine`.
- `zero-auth-wallet/store/auth-store.ts`: Persistent session/credential state with `zustand` + `AsyncStorage` adapter.

## Naming Conventions

**Files:**
- Expo screens/components follow `PascalCase.tsx` for React components (e.g., `SessionCard.tsx`, `CustomAlert.tsx`) and hyphenated directories for route groups (`add-credential`, `(tabs)`).
- Utility files under `lib/` and `store/` use `kebab-case` with descriptive suffixes (e.g., `wallet.ts`, `auth-store.ts`).

**Directories:**
- `app/(tabs)` holds tabbed routes; each `.tsx` file inside becomes a tab screen (`index.tsx`, `history.tsx`, etc.).
- Feature flows get their own directories (`add-credential/`, `add-credential/verify.tsx`) to keep route isolation aligned with Expo Router semantics.

## Where to Add New Code

**New Wallet Feature:**
1. Add the screen under `zero-auth-wallet/app/` (e.g., `app/new-feature.tsx`) or inside a route group if it is nested.
2. Place shared UI in `zero-auth-wallet/components/` (PascalCase) and business helpers in `zero-auth-wallet/lib/`.
3. Extend persisted data via `useAuthStore`/`useWalletStore` (`zero-auth-wallet/store/`) and expose actions that mutate `sessions`, `credentials`, or wallet flags.

**New Relay Endpoint:**
- Add Express handlers in `zero-auth-relay/src/index.ts`, validate inputs with Zod, and delegate business logic to `zero-auth-relay/src/services/session.service.ts` so shared verification/persistence lives in one place.

**New Utility:**
- For shared helpers that cross UI/state boundaries, add files under `zero-auth-wallet/lib/` (hashing, proof, wallet) or `zero-auth-relay/src/lib/` (network, redis, verifier).

## Special Directories

**`zero-auth-wallet/.expo/`:**
- Purpose: Expo cache (runtime metadata, manifest). Generated: Yes. Committed: Contains CLI state but should be regenerated by `expo` commands; avoid manual edits.

**`zero-auth-wallet/circuits/`:**
- Purpose: Source and compiled Circom artifacts for proofs. Generated: Produced by scripts such as `zero-auth-wallet/scripts/compile-circuit.sh`. Committed: Yes, to keep proofs reproducible.

**`zero-auth-wallet/assets/circuits/`:**
- Purpose: Shipping copies of verification keys consumed by the `ZKEngine`. Generated: Created via `scripts/bundle-zk.js`. Committed: Yes, so the WebView bridge has base64 blobs.

**`zero-auth-relay/dist/`:**
- Purpose: `tsc` build output for deployments. Generated: Yes, by `npm run build` (if added). Committed: Present to support quick launches.

---

*Structure analysis: 2026-02-18*
