---
phase: 01-apk-parity-release-hardening
plan: 05
type: execute
wave: 2
depends_on: [01-01]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "WAL-01: Credential add/revoke exists and functions"
    - "WAL-02: ZK proof generation + hashing exists"
    - "WAL-03: Scanner/QR reading exists"
    - "WAL-05: DID + ed25519 keypair generation exists"
    - "WAL-06: Verification approval flow exists"
  artifacts:
    - path: "zero-auth-wallet/app/(tabs)/credentials.tsx"
      provides: "Credential add/revoke UI"
    - path: "zero-auth-wallet/lib/proof.ts"
      provides: "ZK proof generation"
    - path: "zero-auth-wallet/lib/hashing.ts"
      provides: "Poseidon hashing"
    - path: "zero-auth-wallet/app/(tabs)/scanner.tsx"
      provides: "QR code scanner"
    - path: "zero-auth-wallet/lib/wallet.ts"
      provides: "DID + ed25519 keypair"
    - path: "zero-auth-wallet/app/approve-request.tsx"
      provides: "Verification approval flow"
---

<objective>
Verify all WAL (Wallet) requirements exist and are functional in the APK.

Purpose: Confirm existing codebase implementations of WAL-01 through WAL-06 work correctly
Output: Verification that all wallet features exist in the built APK
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
# Existing implementations (already in codebase)
@zero-auth-wallet/app/(tabs)/credentials.tsx
@zero-auth-wallet/lib/wallet.ts
@zero-auth-wallet/lib/proof.ts
@zero-auth-wallet/lib/hashing.ts
@zero-auth-wallet/app/(tabs)/scanner.tsx
@zero-auth-wallet/app/approve-request.tsx
@zero-auth-wallet/lib/qr-protocol.ts
</context>

<tasks>

<task type="auto">
  <name>Verify WAL-01: Credential add/revoke exists</name>
  <files>zero-auth-wallet/app/(tabs)/credentials.tsx</files>
  <action>
    Verify the credentials screen contains:
    1. Add credential button (routes to /add-credential)
    2. Revoke credential button with confirmation dialog
    3. List of stored credentials
    
    Already implemented in credentials.tsx:
    - Add button on line 92-97: routes to '/add-credential'
    - Revoke button on line 57-60: shows CustomAlert for confirmation
    - handleConfirmRevoke on line 71-82: removes credential
  </action>
  <verify>
    grep -l "add-credential\|removeCredential\|handleConfirmRevoke" zero-auth-wallet/app/\(tabs\)/credentials.tsx
  </verify>
  <done>
    WAL-01 verified: Add/revoke functionality exists
  </done>
</task>

<task type="auto">
  <name>Verify WAL-02: ZK proof + hashing exists</name>
  <files>
    zero-auth-wallet/lib/proof.ts
    zero-auth-wallet/lib/hashing.ts
  </files>
  <action>
    Verify ZK proof and hashing functionality:
    
    lib/hashing.ts contains:
    - poseidonHash(): Computes Poseidon hash via ZK Bridge
    - commitAttribute(): Creates commitment for attribute values
    
    lib/proof.ts contains:
    - generateProof(): Generates ZK proof for credential verification
    - prepareInputs(): Prepares circuit inputs based on credential type
    - performProof(): Executes proof generation via ZK Engine
  </action>
  <verify>
    grep -E "generateProof|poseidonHash|commitAttribute" zero-auth-wallet/lib/proof.ts zero-auth-wallet/lib/hashing.ts
  </verify>
  <done>
    WAL-02 verified: ZK proof + hashing exists
  </done>
</task>

<task type="auto">
  <name>Verify WAL-03: Scanner/QR reading exists</name>
  <files>zero-auth-wallet/app/(tabs)/scanner.tsx</files>
  <action>
    Verify scanner screen functionality:
    
    scanner.tsx contains:
    - CameraView from expo-camera for QR scanning
    - onBarcodeScanned handler that:
      - Parses QR using parseVerificationQR()
      - Routes to /approve-request with parsed request
    - Permission handling for camera access
    - UI overlay with scan frame
  </action>
  <verify>
    grep -E "CameraView|onBarcodeScanned|parseVerificationQR|approve-request" zero-auth-wallet/app/\(tabs\)/scanner.tsx
  </verify>
  <done>
    WAL-03 verified: Scanner/QR reading exists
  </done>
</task>

<task type="auto">
  <name>Verify WAL-05: DID + ed25519 keypair exists</name>
  <files>zero-auth-wallet/lib/wallet.ts</files>
  <action>
    Verify DID and keypair generation:
    
    wallet.ts contains:
    - generateAndStoreIdentity(): Generates Ed25519 keypair and stores in SecureStore
    - getWalletIdentity(): Retrieves stored keypair and derives DID
    - deriveDID(): Creates did:key from Ed25519 public key (W3C spec: 0xed01 prefix + base58btc)
    - signMessage(): Signs messages with private key
    
    Uses @noble/curves/ed25519 for cryptographic operations
  </action>
  <verify>
    grep -E "ed25519|deriveDID|generateAndStoreIdentity|getWalletIdentity" zero-auth-wallet/lib/wallet.ts
  </verify>
  <done>
    WAL-05 verified: DID + ed25519 keypair generation exists
  </done>
</task>

<task type="auto">
  <name>Verify WAL-06: Verification steps exist</name>
  <files>zero-auth-wallet/app/approve-request.tsx</files>
  <action>
    Verify verification approval flow:
    
    approve-request.tsx contains complete verification flow:
    1. Request parsing from QR data
    2. Credential matching by type
    3. Biometric authentication (if enabled)
    4. ZK proof generation via generateProof()
    5. Proof submission to verifier callback URL
    6. Session history update
    
    Steps:
    - handleApprove(): Main approval handler
    - LocalAuthentication: Biometric gate
    - generateProof(): Creates ZK proof
    - fetch(callbackUrl): Submits proof to verifier
  </action>
  <verify>
    grep -E "handleApprove|generateProof|LocalAuthentication|callback" zero-auth-wallet/app/approve-request.tsx
  </verify>
  <done>
    WAL-06 verified: Verification approval flow exists
  </done>
</task>

<task type="auto">
  <name>Verify QR protocol parsing exists</name>
  <files>zero-auth-wallet/lib/qr-protocol.ts</files>
  <action>
    Verify QR protocol handling:
    
    qr-protocol.ts (referenced by scanner and my-qr) contains:
    - VerificationRequest type definition
    - parseVerificationQR(): Parses QR code data into request
    - createVerificationQR(): Creates QR payload for verification requests
    
    This enables scanner to understand QR codes and my-qr to generate them
  </action>
  <verify>
    grep -E "parseVerificationQR|VerificationRequest" zero-auth-wallet/lib/qr-protocol.ts
  </verify>
  <done>
    QR protocol handling verified
  </done>
</task>

</tasks>

<verification>
All WAL requirements verified as existing in codebase:
- WAL-01: credentials.tsx (add/revoke)
- WAL-02: proof.ts + hashing.ts (ZK proof + hash)
- WAL-03: scanner.tsx (QR scanning)
- WAL-05: wallet.ts (DID + ed25519)
- WAL-06: approve-request.tsx (verification flow)
</verification>

<success_criteria>
- [ ] All 5 WAL requirements verified in source code
- [ ] APK build includes all wallet features
- [ ] Ready for end-to-end testing in APK
</success_criteria>

<output>
After completion, create `.planning/phases/01-apk-parity-release-hardening/01-05-SUMMARY.md`
</output>
